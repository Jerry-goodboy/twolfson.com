// Auto-respawn appsetTimeout( function () {  // var cp = require('child_process');  // cp.fork('./app.js');  // process.exit(0);}, 5000 );// }, 24 * 60 * 60 * 1000 );var express = require('express'),		app = express.createServer(),		ejs = require('ejs');app.use('/public', express.static(__dirname + '/public'));app.set('view engine', 'ejs');app.error(function (err, req, res, next) {	if(err instanceof NotFound) {		res.render('404.ejs', {'page': '404'});	} else {		next(err);	}});var fs = require('fs');fs.readFile('./jobs.json', 'utf8', function (err, jobsJson) {  if (err) {    throw Error('jobs.json could not be read. ' + err);  }// All pagesvar pages = ['resume', 'portfolio', 'contact'],// Parse JSON [I like single quotes in my JSON, so no JSON.parse]    jobs = (new Function('return ' + jobsJson)());function bindToMainPages(method, eachFn) {  var page,      i;  for( i = pages.length; i--; ) {    page = pages[i];    app[method]('/' + page, eachFn(page));  }}// Set up page infobindToMainPages('all', function (page) {  return function (req, res, next) {    req.info = {'page': page};    next();  };});// Bind jobs JSON to resumeapp.get('/resume', function (req, res, next) {  req.info.jobs = jobs;  next();});// Contact form handlingvar email = require('emailjs'),    emailConf = require('./mail.conf'),    emailServer = email.server.connect(emailConf);app.post('/contact', function (req, res, next) {  express.bodyParser()(req, res, function () {    var info = req.info,        body = req.body,        message = "";        // Compose the text message    message += "Name: " + body.name + "\n";    message += "Info: " + body.info + "\n";    message += "Message: " + body.message + "";    // Send a message to todd    // TODO: Send a confirmation email to the user    emailServer.send({      'text': message,      'from': 'No Reply <no-reply@twolfson.com>',      'to': 'Todd Wolfson <todd@twolfson.com>',      'subject': 'Incoming query from twolfson.com'    }, function (err, message) {      info.status = !err;      res.render('contact.ejs', info);    });  });});// Render pagesbindToMainPages('get', function (page) {  return function (req, res) {    res.render(page + '.ejs', req.info);  };});// Default page is resumeapp.get('/', function (req, res) {  res.redirect('/resume');});app.all('*', function(req, res){	throw new NotFound;});app.listen(8080);console.log("Server running at http://127.0.0.1:8080/");});function NotFound(msg){    this.name = 'NotFound';    Error.call(this, msg);    Error.captureStackTrace(this, arguments.callee);}