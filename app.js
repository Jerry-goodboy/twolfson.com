// Set up server basicsvar express = require('express'),		app = express.createServer(),		ejs = require('ejs');app.use('/public', express['static'](__dirname + '/public'));app.set('view engine', 'ejs');// Set up email server interactionvar email = require('emailjs'),    emailConf = require('./mail.conf'),    emailServer = email.server.connect(emailConf);// Set up info for all of the pagesapp.all('/resume', getInfoFn('resume'));app.all('/portfolio', getInfoFn('portfolio'));app.all('/contact', getInfoFn('contact'));function getInfoFn(page) {  return function (req, res, next) {    req.info = {'page': page};    next();  };}// Bind jobs JSON to resume (there are single quotes in my JSON so &*#! require in this case)var fs = require('fs'),    jobsJson = fs.readFileSync('./jobs.json', 'utf8'),    jobs = (new Function('return ' + jobsJson + ';')());app.get('/resume', function (req, res, next) {  req.info.jobs = jobs;  next();});// Render get for all pagesapp.get('/resume', getRenderFn('resume'));app.get('/portfolio', getRenderFn('portfolio'));app.get('/contact', getRenderFn('contact'));function getRenderFn(page) {  return function (req, res) {    res.render(page + '.ejs', req.info);  };}// The default page will be redirected to the resume pageapp.get('/', function (req, res) {  res.redirect('/resume');});// Upon submission of the contact formvar bodyParser = express.bodyParser();app.post('/contact', function (req, res, next) {  // Parse the body  bodyParser(req, res, function () {    var info = req.info,        body = req.body,        message = "";    // Compose the text message    message += "Name: " + body.name + "\n";    message += "Info: " + body.info + "\n";    message += "Message: " + body.message + "";    // Send a message to todd    emailServer.send({      'text': message,      'from': 'No Reply <no-reply@twolfson.com>',      'to': 'Todd Wolfson <todd@twolfson.com>',      'subject': 'Incoming query from twolfson.com'    }, function (err, message) {      info.status = !err;      res.render('contact.ejs', info);    });  });});// If the page is not found, throw an error and redirect to the 404 pageapp.all('*', function (req, res) {  res.render('404.ejs', {'page': '404'}, function (err, content) {    res.send(content, 404);  });});// Begin listening for requestsapp.listen(8080);console.log("Server running at http://127.0.0.1:8080/");