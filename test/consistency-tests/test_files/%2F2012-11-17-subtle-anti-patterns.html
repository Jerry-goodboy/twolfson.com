<!DOCTYPE html>
<html>
<head>
	<title>Subtle anti-patterns - Todd Wolfson</title>
  <link rel="shortcut icon" href="/public/images/favicon.ico">
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato|Ubuntu+Mono" type="text/css">
  <!-- Full CSS available at /public/css/index.css .-->
  <link rel="stylesheet" href="/public/css/index.min.css" type="text/css" media="all">
  <link rel="alternate" href="/index.xml" title="twolfson.com blog feed" type="application/atom+xml">
  
    <meta name="keywords" content="anti-patterns, subtle">
  
  
    <meta name="description" content="Warning: This article is more opinionated than other ones.">
  
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  
  <script type="text/javascript">
    window.env = "test";
  </script>
  <script src="/public/js/index.js"></script>
  
</head>
<body>
  <div id="global-wrapper" class="container">
    <div id="global-main">
      
      
      <div class="flexbox container__row push-half--top push-half--bottom">
        <h1 class="brand flexbox__item width4 align--baseline">
          <a href="/" class="link--hidden">Todd Wolfson</a>
        </h1>
        <h2 class="brand flexbox__item width5 align--baseline">
          Software Engineer
        </h2>
        <div class="flexbox__item text--right alpha">
          <a href="http://github.com/twolfson/" class="icon-github push--right" target="_blank"></a>
          <a href="http://twitter.com/twolfsn/" class="icon-twitter push--right" target="_blank"></a>
          <a href="/index.xml" class="icon-rss" target="_blank"></a>
        </div>
      </div>
      
      
      <div class="row--bordered--ends push--bottom">
        <div class="container__row">
          <ul class="nav">
          
          
          
          
          
            <li class="nav--item">
              <a href="/" class="link--active">blog</a>
            </li>
          
            <li class="nav--item">
              <a href="/projects" class="">projects</a>
            </li>
          
            <li class="nav--item">
              <a href="/contact" class="">contact</a>
            </li>
          
            <li class="nav--item float--right">
              
              <a href="/support-me" class="">support me</a>
            </li>
          </ul>
        </div>
      </div>
      <div id="article" class="container__row">
  <div id="article__content" class="span8">
    <div>
      <div>
        November 17, 2012
      </div>
      <div>
        <h1 id="subtle-anti-patterns" class="beta">
          <a href="#subtle-anti-patterns" class="link--hover-only">Subtle anti-patterns</a>
        </h1>
      </div>
    </div>

    <div>
      
      <p><strong>Warning: This article is more opinionated than other ones.</strong></p>
<p>As with everyone, I have began to develop opinions on certain styles of code; some concious and practical, others gutteral and more difficult to explain.</p>
<p>Below is a list of those that fall into the latter category but I have squeezed logic out of.</p>
<p>As a reminder, anti-patterns are not things that should be avoided at all costs; they have their place in quick and simple code. However, for maintainable and future-proof reasons, it is better to avoid them.</p>
<h3 id="anti-pattern-1-writing-directly-to-an-object"><a href="#anti-pattern-1-writing-directly-to-an-object" class="link--hover-only">Anti-pattern #1: Writing directly to an object</a></h1>
<h4 id="the-pattern"><a href="#the-pattern" class="link--hover-only">The pattern</a></h2>
<pre><code class="js">var algorithms = {};
algorithms[&#39;top-down&#39;] = topDownFn;
algorithms[&#39;left-right&#39;] = leftRightFn;
algorithms[&#39;diagonal&#39;] = diagFn;</code></pre>
<h4 id="why-this-is-bad"><a href="#why-this-is-bad" class="link--hover-only">Why this is bad</a></h2>
<p>You have written a direct reference to the map. However, what if you want to move to an array store or the variable becomes abstracted into a class. In either of those cases, those last 3 lines will have to be updated.</p>
<p>If that does not seem like a lot, imagine those were 20 lines and you wound up going back and forth a lot. There is a large margin for error and debugging will also not be fun.</p>
<h4 id="how-to-make-it-better"><a href="#how-to-make-it-better" class="link--hover-only">How to make it better</a></h2>
<p>Your first thought is probably &quot;objectify them into an array and iterate over that array&quot;. This is not bad for a first thought but as you will see in #2, it still does not fully hit the mark.</p>
<p>It is best to abstract this into a helper function</p>
<pre><code class="js">var algorithms = {};
function addAlgorithm(name, fn) {
  algorithms[name] = fn;
}
addAlgorithm(&#39;top-down&#39;, topDownFn);
addAlgorithm(&#39;left-right&#39;, leftRightFn);
addAlgorithm(&#39;diagonal&#39;, diagFn);</code></pre>
<p>Now we have taken a direct connection and loosened it up a bit.</p>
<p>We can even go one step further and turn this into a full-fledged class.</p>
<pre><code class="js">function AlgorithmKeeper() {
  this.algorithms = {};
}
AlgorithmKeeper.prototype = {
  &#39;add&#39;: function (name, fn) {
    var algorithms = this.algorithms;
    algorithms[name] = fn;
  }
};</code></pre>
<h4 id="bonus"><a href="#bonus" class="link--hover-only">Bonus</a></h2>
<p>Now that we are going through a function, we can add additional one-off logic, effectively leaving the base function. This is great if the items you are adding are from a repo that you don&#39;t own.</p>
<pre><code class="js">function addAlgorithm(params) {
  var name = params.name,
      algorithm = params.algorithm,
      defaults = params.defaults || {},
      saveFn = algorithm;

  // If defaults exist, override the saveFn to fallback to defaults
  if (defaults) {
    saveFn = function (data) {
      _.defaults(data, defaults);
      return algorithm(data);
    };
  }

  // Save our saveFn
  algorithms[name] = saveFn;
}</code></pre>
<h3 id="anti-pattern-2-binding-by-iterating-over-an-array"><a href="#anti-pattern-2-binding-by-iterating-over-an-array" class="link--hover-only">Anti-pattern #2: Binding by iterating over an array</a></h1>
<h4 id="the-pattern"><a href="#the-pattern" class="link--hover-only">The pattern</a></h2>
<pre><code class="js">var bindingElts = [{
      &#39;name&#39;: &#39;top-down&#39;,
      &#39;fn&#39;: topDownFn
    }, {
      &#39;name&#39;: &#39;left-right&#39;,
      &#39;fn&#39;: leftRightFn
    }, {
      &#39;name&#39;: &#39;diagonal&#39;,
      &#39;fn&#39;: diagFn
    }];
bindingElts.forEach(function (bindingElt) {
  addAlgorithm(bindingElt.name, bindingElt.fn);
});</code></pre>
<h4 id="why-this-is-bad"><a href="#why-this-is-bad" class="link--hover-only">Why this is bad</a></h2>
<p>It is harder to distinguish items and account for one-off cases. Additionally, if there is an issue inside of the <code>forEach</code> itself, the stack trace will not inform you which item failed. The stack trace will provide the line number of <code>addAlgorithm</code> but nothing about the specific <code>bindingElt</code>.</p>
<h4 id="how-to-make-it-better"><a href="#how-to-make-it-better" class="link--hover-only">How to make it better</a></h2>
<pre><code class="js">addAlgorithm(&#39;top-down&#39;, topDownFn);
addAlgorithm(&#39;left-right&#39;, leftRightFn);
addAlgorithm(&#39;diagonal&#39;, diagFn);</code></pre>
<p>This makes each item have a nice line number attached to the stack trace which will lead to faster debugging.</p>
<h4 id="bonus"><a href="#bonus" class="link--hover-only">Bonus</a></h2>
<p>If there is a problem we need to debug, we can take the trouble-maker line and pass it through a one-off function. This effectively isolates it from the noise of other bindings.</p>
<pre><code class="js">function addAlgorithmDebug(name, fn) {
  console.log(&#39;Adding &#39; + name + &#39; to algorithms&#39;);
  algorithms[name] = fn;
  console.log(&#39;Done adding &#39; + name + &#39; to algorithms&#39;);
}
addAlgorithm(&#39;top-down&#39;, topDownFn);
addAlgorithmDebug(&#39;left-right&#39;, leftRightFn);
addAlgorithm(&#39;diagonal&#39;, diagFn);</code></pre>
<h3 id="anti-pattern-3-defining-a-finite-set-of-similar-types"><a href="#anti-pattern-3-defining-a-finite-set-of-similar-types" class="link--hover-only">Anti-pattern #3: Defining a finite set of similar types</a></h1>
<h4 id="the-pattern"><a href="#the-pattern" class="link--hover-only">The pattern</a></h2>
<pre><code class="js">var algorithms = {
      &#39;top-down&#39; : topDownFn,
      &#39;left-right&#39;: leftRightFn,
      &#39;diagonal&#39; : diagFn
    };</code></pre>
<h4 id="why-this-is-bad"><a href="#why-this-is-bad" class="link--hover-only">Why this is bad</a></h2>
<p>This one isn&#39;t that bad but it <em>can</em> be improved. This pattern unintentionally limits others from adding new items to the set. Another side effect is that there is no easy way to hook into when an addition occurs.</p>
<h4 id="how-to-make-it-better"><a href="#how-to-make-it-better" class="link--hover-only">How to make it better</a></h2>
<p>As we have demonstrated in #1, we can use a function like <code>addAlgorithm</code>. Then, we can expose <code>addAlgorithm</code> to make setting up another one easily for others.</p>
<pre><code class="js">var algorithms = {};
function addAlgorithm(name, fn) {
  algorithms[name] = fn;
}
addAlgorithm(&#39;top-down&#39;, topDownFn);
addAlgorithm(&#39;left-right&#39;, leftRightFn);
addAlgorithm(&#39;diagonal&#39;, diagFn);

module.exports = {
  &#39;algorithms&#39;: algorithms,
  &#39;addAlgorithm&#39;: addAlgorithm
};</code></pre>
<h4 id="bonus"><a href="#bonus" class="link--hover-only">Bonus</a></h2>
<p>What you might not notice at first glance is that <code>addAlgorithm</code> is the <a href="http://en.wikipedia.org/wiki/Observer_pattern">Observer pattern</a>.</p>
<pre><code class="js">AlgorithmKeeper.on(&#39;add&#39;, function (name, fn) {
  algorithms[name] = fn;
});
AlgorithmKeeper.emit(&#39;add&#39;, &#39;top-down&#39;, topDownFn);
AlgorithmKeeper.emit(&#39;add&#39;, &#39;left-right&#39;, leftRightFn);
AlgorithmKeeper.emit(&#39;add&#39;, &#39;diagonal&#39;, diagFn);</code></pre>
<p>In previous examples, we have simplified it by removing the need for a third party tracker.</p>
<p>However, if we did go this route, then we could have other people listen and hook in to our algorithm addition events. <strong>CRAZY AWESOME!!</strong></p>
<pre><code class="js">AlgorithmKeeper.on(&#39;add&#39;, function (name) {
  console.log(&#39;Someone is adding a new algorithm: &#39; + name);
});</code></pre>
<h3 id="anti-pattern-4-composition-of-functions"><a href="#anti-pattern-4-composition-of-functions" class="link--hover-only">Anti-pattern #4: Composition of functions</a></h1>
<h4 id="the-pattern"><a href="#the-pattern" class="link--hover-only">The pattern</a></h2>
<pre><code class="js">function addSalt(str) {
  return str + &#39;salt&#39;;
}
function addPepper(str) {
  return str + &#39;pepper&#39;;
}

var pasta = &#39;pasta&#39;;
pasta = addSalt(addPepper(pasta));</code></pre>
<h4 id="why-this-is-bad"><a href="#why-this-is-bad" class="link--hover-only">Why this is bad</a></h2>
<p>The code is not quickly and easily readible. However, the issue arises out of adding new items</p>
<pre><code class="js">function addSauce(str) {
  return str + &#39;sauce&#39;;
}
function addRosemary(str) {
  return str + &#39;rosemary&#39;;
}

var pasta = &#39;pasta&#39;;
pasta = addSalt(addPepper(addSauce(addRosemary(pasta))));</code></pre>
<p>Ah, that is nice and <a href="http://en.wikipedia.org/wiki/Lisp_%28programming_language%29">Lispy</a> now. We could add line feeds or break it into separate lines but that is lipstick on a pig.</p>
<p>The worst would be to add all 4 functions into a single function. Then, all functional combinations would reach 15 functions <code>addSaltAndPepper</code>, <code>addSaltAndSauce</code>, &hellip;, <code>addSaltPepperSauceRosemary</code> (excluding noop). Clearly, that is not maintainable.</p>
<h4 id="how-to-make-it-better"><a href="#how-to-make-it-better" class="link--hover-only">How to make it better</a></h2>
<p>If we step back, we can notice that we are constantly passing the same state into each function. Classes were <strong>built</strong> for this; functions are stateless and classes are stateful.</p>
<p>If we move this into a class with a fluent interface, life becomes awesome.</p>
<pre><code class="js">function Food(str) {
  this.str = str;
}
Food.prototype = {
  &#39;addSalt&#39;: function () {
    this.str += &#39;salt&#39;;
    return this;
  },
  &#39;addPepper&#39;: function () {
    this.str += &#39;pepper&#39;;
    return this;
  },
  &#39;addSauce&#39;: function () {
    this.str += &#39;sauce&#39;;
    return this;
  },
  &#39;addRosemary&#39;: function () {
    this.str += &#39;rosemary&#39;;
    return this;
  }
};
var pasta = new Food(&#39;pasta&#39;);
pasta.addSalt().addPepper().addSauce().addRosemary();</code></pre>
<p><strong>Side note</strong>: If you have been paying attention, you might notice the prototype is a finite set. I usually let prototypes slide by this rule. However, we could consider adding a method like <code>addCondiment</code> which would add a new method onto the prototype.</p>

    </div>

    
  </div>
  <div class="span4">
    
    
    
        <h2 class="gamma">Top articles</h2>
        
          <div class="cluster">
            <h3 class="delta"><a href="/2013-07-27-develop-faster">Develop faster</a></h3>
            <p>Removing the tedium from creating, developing, and publishing repos.</p>

          </div>
        
          <div class="cluster">
            <h3 class="delta"><a href="/2013-08-15-sexy-bash-prompt">Sexy bash prompt</a></h3>
            <p>A <a href="https://github.com/twolfson/sexy-bash-prompt">bash prompt</a> with colors, git statuses, and git branches.</p>

          </div>
        
    
    
        <h2 class="gamma">Recent articles</h2>
        
          <div class="cluster">
            <h3 class="delta"><a href="/2015-02-06-automate-your-style">Automate your style</a></h3>
            <p>Introduction to automatically checking and formatting code style.</p>

          </div>
        
    
  </div>
</div>

    </div>
  </div>
  <div id="global-footer" class="container text--center center--center">
    <div>
      
      <hr class="width5 center--center push-half--bottom">
    </div>
    <p class="flush--bottom"><small>
      Built by <a href="/contact">Todd Wolfson</a> under the <a href="/license">MIT License</a>
      <br>
      Powered by <a href="http://expressjs.com/">express</a> and <a href="http://twolfson.github.com/jojo/">jojo</a></small></p>
  </div>
</body>
</html>
